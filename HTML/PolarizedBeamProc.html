
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-solarized-light .ace_gutter {background: #fbf1d3;color: #333}.ace-solarized-light .ace_print-margin {width: 1px;background: #e8e8e8}.ace-solarized-light {background-color: #FDF6E3;color: #586E75}.ace-solarized-light .ace_cursor {color: #000000}.ace-solarized-light .ace_marker-layer .ace_selection {background: rgba(7, 54, 67, 0.09)}.ace-solarized-light.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #FDF6E3;}.ace-solarized-light .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-solarized-light .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(147, 161, 161, 0.50)}.ace-solarized-light .ace_marker-layer .ace_active-line {background: #EEE8D5}.ace-solarized-light .ace_gutter-active-line {background-color : #EDE5C1}.ace-solarized-light .ace_marker-layer .ace_selected-word {border: 1px solid #073642}.ace-solarized-light .ace_invisible {color: rgba(147, 161, 161, 0.50)}.ace-solarized-light .ace_keyword,.ace-solarized-light .ace_meta,.ace-solarized-light .ace_support.ace_class,.ace-solarized-light .ace_support.ace_type {color: #859900}.ace-solarized-light .ace_constant.ace_character,.ace-solarized-light .ace_constant.ace_other {color: #CB4B16}.ace-solarized-light .ace_constant.ace_language {color: #B58900}.ace-solarized-light .ace_constant.ace_numeric {color: #D33682}.ace-solarized-light .ace_fold {background-color: #268BD2;border-color: #586E75}.ace-solarized-light .ace_entity.ace_name.ace_function,.ace-solarized-light .ace_entity.ace_name.ace_tag,.ace-solarized-light .ace_support.ace_function,.ace-solarized-light .ace_variable,.ace-solarized-light .ace_variable.ace_language {color: #268BD2}.ace-solarized-light .ace_storage {color: #073642}.ace-solarized-light .ace_string {color: #2AA198}.ace-solarized-light .ace_string.ace_regexp {color: #D30102}.ace-solarized-light .ace_comment,.ace-solarized-light .ace_entity.ace_other.ace_attribute-name {color: #93A1A1}.ace-solarized-light .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYHjy8NJ/AAjgA5fzQUmBAAAAAElFTkSuQmCC) right repeat-y}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      
      <div id="titlearea">
        <h2>Polarized Beam Characterization Procedure</h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><p>2017-12-13 Seiji Kameno</p>
</div><div class="cell markdown-cell"><h1>Overview</h1>
<p>This document describes step-by-step procedure of data reduction for polarized beam characterization. This processes datasets of full-polarization astro-holography measurements and generates antenna-based in-beam maps of D-term spectra, in-beam maps of Stokes spectra, and error maps.<br>
See also details of the methodology is described in the report <a href="http://www.alma.cl/~skameno/POLBEAM/PolBeam20160923.pdf">ALMA Polarization Beam Characterization</a>.</p>
</div><div class="cell markdown-cell"><h1>Preperation</h1>
<h2>Repository of scripts</h2>
<p>To clone scripts for the first time, type</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">git</span> <span class="ace_identifier">clone</span> <span class="ace_identifier">https</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">github</span>.<span class="ace_identifier">com</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">kamenoseiji</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">ALMA_SV</span>.<span class="ace_identifier">git</span>
</div></div></div></div><div class="cell markdown-cell"><p>then, a new directory 'ALMA_SV' is generated. All of scripts are stored there.<br>
To update scripts, type in the ALMA_SV directory</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">git</span> <span class="ace_identifier">pull</span>
</div></div></div></div><div class="cell markdown-cell"><p>It is recommended to update everytime you start reduction.</p>
</div><div class="cell markdown-cell"><h2>Working directory</h2>
<p>Prepare a working directory where you can run CASA and you have a write permission.</p>
</div><div class="cell markdown-cell"><h2>ASDM files</h2>
<p>At the working directory, download datasets from the ALMA archive. For example, Band-6 astroholography datasets observed on 2015-05-08 are:</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">X69a</span> <span class="ace_comment"># Delay Cal</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">X6a1</span> <span class="ace_comment"># astroholo Group 1</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">X6f2</span> <span class="ace_comment"># astroholo Group 2</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">X91c</span> <span class="ace_comment"># Delay Cal</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">X920</span> <span class="ace_comment"># astroholo Group 1</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">X96d</span> <span class="ace_comment"># astroholo Group 2</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xc9b</span> <span class="ace_comment"># Delay Cal</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xcab</span> <span class="ace_comment"># astroholo Group 1</span>
</div><div class="ace_line"><span class="ace_identifier">asdmExport</span> <span class="ace_identifier">uid</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">A002</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xa018c4</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Xd3b</span> <span class="ace_comment"># astroholo Group 2</span>
</div></div></div></div><div class="cell markdown-cell"><p>For these datasets, Group 1 and 2 uses tracking and scanning antennas as:</p>
<table>
<thead>
<tr>
<th style="text-align:right">Group</th>
<th style="text-align:left">Tracking antennas</th>
<th style="text-align:left">Scanning antennas</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">DA55 DA59 DV01 DV05 DV07 DV08 DV11 DV12 DV17 DV18 DV19 DV20 DV21 DV24 PM03 PM04</td>
<td style="text-align:left">DA41 DA44 DA45 DA46 DA47 DA49 DA50 DA51 DA53 DA58 DA60 DA61 DA62 DA64 DV02 DV13</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">DA41 DA44 DA45 DA46 DA47 DA49 DA50 DA51 DA53 DA58 DA60 DA61 DA62 DA64 DV02 DV13</td>
<td style="text-align:left">DA55 DA59 DV01 DV05 DV07 DV08 DV11 DV12 DV17 DV18 DV19 DV20 DV21 DV24 PM03 PM04</td>
</tr>
</tbody>
</table>
</div><div class="cell markdown-cell"><h1>Data Reduction</h1>
<p>The reduction procedure mainly compesed by 4 steps of WVR correction, bandpass calibration, Q and U determination, and in-beam profiling.</p>
</div><div class="cell markdown-cell"><h2>Step.1 WVR correction</h2>
<p>This step converts all of ASDMs into MSs, applies WVR correction, and select only spectral SPWs. Prepare a python script <a href="http://www.alma.cl/~skameno/AMAPOLA/WVR.py">WVR.py</a></p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_comment"># WVR.py</span>
</div><div class="ace_line"><span class="ace_identifier">prefixList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_string">'uid___A002_Xa018c4_X69a'</span>, <span class="ace_string">'uid___A002_Xa018c4_X6a1'</span>, <span class="ace_string">'uid___A002_Xa018c4_X6f2'</span>, <span class="ace_string">'uid___A002_Xa018c4_X91c'</span>, <span class="ace_string">'uid___A002_Xa018c4_X920'</span>, <span class="ace_string">'uid___A002_Xa018c4_X96d'</span>, <span class="ace_string">'uid___A002_Xa018c4_Xc9b'</span>, <span class="ace_string">'uid___A002_Xa018c4_Xcab'</span>, <span class="ace_string">'uid___A002_Xa018c4_Xd3b'</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_keyword">for</span> <span class="ace_identifier">prefix</span> <span class="ace_keyword">in</span> <span class="ace_identifier">prefixList</span>:
</div><div class="ace_line">    <span class="ace_identifier">importasdm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">prefix</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line">    <span class="ace_identifier">listobs</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">vis</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.ms'</span>, <span class="ace_identifier">scan</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">''</span>, <span class="ace_identifier">spw</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">''</span>, <span class="ace_identifier">verbose</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span>, <span class="ace_identifier">listfile</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.listobs'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line">    <span class="ace_identifier">wvrgcal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sourceflag</span><span class="ace_keyword ace_operator">=</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">caltable</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'cal-'</span><span class="ace_keyword ace_operator">+</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.WVR'</span>, <span class="ace_identifier">smooth</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'2.016s'</span>, <span class="ace_identifier">spw</span><span class="ace_keyword ace_operator">=</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1</span>,<span class="ace_constant ace_numeric">3</span>,<span class="ace_constant ace_numeric">5</span>,<span class="ace_constant ace_numeric">7</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">vis</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.ms'</span>, <span class="ace_identifier">wvrspw</span><span class="ace_keyword ace_operator">=</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">mingoodfrac</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.8</span>, <span class="ace_identifier">disperse</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">False</span>, <span class="ace_identifier">maxdistm</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">500.0</span>, <span class="ace_identifier">minnumants</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">2</span>, <span class="ace_identifier">toffset</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0</span>, <span class="ace_identifier">wvrflag</span><span class="ace_keyword ace_operator">=</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span>
</div><div class="ace_line">    <span class="ace_identifier">applycal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">vis</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.ms'</span>, <span class="ace_identifier">flagbackup</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">False</span>, <span class="ace_identifier">spw</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'1,3,5,7'</span>, <span class="ace_identifier">interp</span><span class="ace_keyword ace_operator">=</span><span class="ace_paren ace_lparen">[</span><span class="ace_string">'nearest'</span>,<span class="ace_string">'nearest'</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">gaintable</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'cal-'</span><span class="ace_keyword ace_operator">+</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.WVR'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line">    <span class="ace_identifier">split</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">vis</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'.ms'</span>, <span class="ace_identifier">outputvis</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">prefix</span><span class="ace_keyword ace_operator">+</span><span class="ace_string">'_WVR.ms'</span>, <span class="ace_identifier">datacolumn</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'corrected'</span>, <span class="ace_identifier">spw</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'1,3,5,7'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_comment">#</span>
</div></div></div></div><div class="cell markdown-cell"><p>and run it.</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">casa</span> <span class="ace_keyword ace_operator">-</span><span class="ace_identifier">c</span> <span class="ace_identifier">WVR</span>.<span class="ace_identifier">py</span>
</div></div></div></div><div class="cell markdown-cell"><h2>Step.2 Bandpass calibration</h2>
<p>In this step, the script <code>checkBP.py</code> determines antenna-based bandpass table. The XY phase spectrum is also produced. Prepare a wrapping file <code>checkBPexec.py</code></p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_comment"># checkBPexec.py</span>
</div><div class="ace_line"><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'/home/skameno/ALMA_SV/'</span>  <span class="ace_comment"># path to the scripts</span>
</div><div class="ace_line"><span class="ace_identifier">wd</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'./'</span>                           <span class="ace_comment"># path to the working directory</span>
</div><div class="ace_line"><span class="ace_identifier">DELAYCAL</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language">False</span>
</div><div class="ace_line"><span class="ace_identifier">BPPLOT</span>   <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language">True</span>
</div><div class="ace_line"><span class="ace_identifier">antFlag</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span>                        <span class="ace_comment"># e.g. antFlag = ['DA46', 'DV03', 'PM02']</span>
</div><div class="ace_line"><span class="ace_identifier">PLOTFMT</span>  <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'pdf'</span>
</div><div class="ace_line"><span class="ace_identifier">polName</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_string">'XX'</span>, <span class="ace_string">'XY'</span>, <span class="ace_string">'YX'</span>, <span class="ace_string">'YY'</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">spwList</span>  <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span>,<span class="ace_constant ace_numeric">1</span>,<span class="ace_constant ace_numeric">2</span>,<span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">BPscan</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">1</span>                          <span class="ace_comment"># scan ID of bandpass calibration</span>
</div><div class="ace_line"><span class="ace_identifier">prefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'uid___A002_Xa018c4_X91c_WVR'</span>
</div><div class="ace_line"><span class="ace_comment">#---- For Group 2</span>
</div><div class="ace_line"><span class="ace_identifier">refant</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'DA45'</span>
</div><div class="ace_line"><span class="ace_support ace_function">execfile</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">'checkBP.py'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_comment">#---- For Group 1</span>
</div><div class="ace_line"><span class="ace_identifier">refant</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'DA59'</span>
</div><div class="ace_line"><span class="ace_support ace_function">execfile</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">'checkBP.py'</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell markdown-cell"><p>and run it.</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">casa</span> <span class="ace_keyword ace_operator">-</span><span class="ace_identifier">c</span> <span class="ace_identifier">checkBPexec</span>.<span class="ace_identifier">py</span>
</div></div></div></div><div class="cell markdown-cell"><p>Then the script generates *-BPant.npy and *-XYspec.npy files that store bandpass and XY-phase table, respectively, in numpy array form. These files are necessary for following steps.</p>
<p>If <code>BPPLOT = True</code> is set, the script also generates a <a href="http://www.alma.cl/~skameno/AMAPOLA/BP_uid___A002_Xa018c4_X91c_WVR_REFDA45_Scan1.pdf">PDF or PNG plot file</a>.<br>
<img src="resources/7AE044D44F4CE269669534AB65D003A7.png" alt="BP.png" width="1233" height="944"></p>
<p>While the best choice of the bandpass scan should be decided by the SNR of XY cross correlation, it is unknown at the stage. After the Step.3, you'll find the best scan and retry the bandpass calibration.</p>
</div><div class="cell markdown-cell"><h2>Step.3 QU determination</h2>
<p>The XY phase determined in Step.2 involves <span class="MathJax" id="MathJax-Element-244-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5749" style="width: 2.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.914em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.35em, 1000em, 2.379em, -0.396em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-5750"><span class="msubsup" id="MathJax-Span-5751"><span style="display: inline-block; position: relative; width: 1.877em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.717em, -0.396em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-5752" style="font-family: STIXGeneral-Regular;">180</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 1.52em;"><span class="texatom" id="MathJax-Span-5753"><span class="mrow" id="MathJax-Span-5754"><span class="mo" id="MathJax-Span-5755" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∘</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.892em; vertical-align: -0.078em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-244">180^{\circ}</script> ambiguity. To solve this, the script <code>beamCenterStokes.py</code> determines Stokes Q and U of the calibrator. It also solve for on-axis D-term spectra. Prepare a wrapping file <a href="http://www.alma.cl/~skameno/AMAPOLA/checkQU.py">checkQU.py</a></p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_comment"># checkQU.py</span>
</div><div class="ace_line"><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'/home/skameno/ALMA_SV/'</span>  <span class="ace_comment"># Script Directory</span>
</div><div class="ace_line"><span class="ace_identifier">wd</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'./'</span>
</div><div class="ace_line"><span class="ace_identifier">prefixList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span>
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_X69a_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_X6a1_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_X6f2_WVR'</span>, 
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_X91c_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_X920_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_X96d_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_Xc9b_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_Xcab_WVR'</span>,
</div><div class="ace_line"><span class="ace_string">'uid___A002_Xa018c4_Xd3b_WVR'</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">antFlag</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">spwList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span>,<span class="ace_constant ace_numeric">1</span>,<span class="ace_constant ace_numeric">2</span>,<span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">Dsmooth</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language">False</span>
</div><div class="ace_line"><span class="ace_identifier">BPprefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'uid___A002_Xa018c4_X91c_WVR'</span>
</div><div class="ace_line"><span class="ace_identifier">refantName</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'DA59'</span> <span class="ace_comment"># in Group 2</span>
</div><div class="ace_line"><span class="ace_support ace_function">execfile</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">'beamCenterStokes.py'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_identifier">refantName</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'DA45'</span> <span class="ace_comment"># in Group 1</span>
</div><div class="ace_line"><span class="ace_support ace_function">execfile</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">'beamCenterStokes.py'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_identifier">os</span>.<span class="ace_identifier">system</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'mkdir DtermB6'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_identifier">os</span>.<span class="ace_identifier">system</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'rename s/uid___A002_Xa018c4_X69a_WVR/B6/ *DSpec.npy'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_identifier">os</span>.<span class="ace_identifier">system</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'mv *DSpec.npy DtermB6/'</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell markdown-cell"><p>and run it.</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">casa</span> <span class="ace_keyword ace_operator">-</span><span class="ace_identifier">c</span> <span class="ace_identifier">checkQU</span>.<span class="ace_identifier">py</span>
</div></div></div></div><div class="cell markdown-cell"><p>This script automatically excluds scanning antennas. Thus, two executions changing the refant are necessary. The script attempts a coarse measurement of (Q, U) using parallel-hand visivilities <span class="MathJax" id="MathJax-Element-245-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5756" style="width: 3.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.703em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.652em, 1000em, 2.916em, -0.43em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5757"><span class="mrow" id="MathJax-Span-5758"><span class="mo" id="MathJax-Span-5759" style=""><span style="font-family: STIXGeneral-Regular;">⟨</span></span><span class="mi" id="MathJax-Span-5760" style="font-family: STIXGeneral-Italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;"></span></span><span class="msubsup" id="MathJax-Span-5761"><span style="display: inline-block; position: relative; width: 1.208em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.536em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5762" style="font-family: STIXGeneral-Italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.689em; left: 0.739em;"><span class="mo" id="MathJax-Span-5763" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5764" style=""><span style="font-family: STIXGeneral-Regular;">⟩</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.153em; vertical-align: -0.299em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-245">\left< XX^* \right></script>, <span class="MathJax" id="MathJax-Element-246-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5765" style="width: 3.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.703em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.652em, 1000em, 2.916em, -0.43em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5766"><span class="mrow" id="MathJax-Span-5767"><span class="mo" id="MathJax-Span-5768" style=""><span style="font-family: STIXGeneral-Regular;">⟨</span></span><span class="mi" id="MathJax-Span-5769" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="msubsup" id="MathJax-Span-5770"><span style="display: inline-block; position: relative; width: 1.218em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.429em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5771" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.689em; left: 0.749em;"><span class="mo" id="MathJax-Span-5772" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5773" style=""><span style="font-family: STIXGeneral-Regular;">⟩</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.153em; vertical-align: -0.299em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-246">\left< YY^* \right></script> as the initial value, and then fits using cross-hand visibilities <span class="MathJax" id="MathJax-Element-247-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5774" style="width: 3.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.703em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.652em, 1000em, 2.916em, -0.43em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5775"><span class="mrow" id="MathJax-Span-5776"><span class="mo" id="MathJax-Span-5777" style=""><span style="font-family: STIXGeneral-Regular;">⟨</span></span><span class="mi" id="MathJax-Span-5778" style="font-family: STIXGeneral-Italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;"></span></span><span class="msubsup" id="MathJax-Span-5779"><span style="display: inline-block; position: relative; width: 1.218em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.429em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5780" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.689em; left: 0.749em;"><span class="mo" id="MathJax-Span-5781" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5782" style=""><span style="font-family: STIXGeneral-Regular;">⟩</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.153em; vertical-align: -0.299em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-247">\left< XY^* \right></script>, <span class="MathJax" id="MathJax-Element-248-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5783" style="width: 3.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.703em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.652em, 1000em, 2.916em, -0.43em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5784"><span class="mrow" id="MathJax-Span-5785"><span class="mo" id="MathJax-Span-5786" style=""><span style="font-family: STIXGeneral-Regular;">⟨</span></span><span class="mi" id="MathJax-Span-5787" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="msubsup" id="MathJax-Span-5788"><span style="display: inline-block; position: relative; width: 1.208em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.536em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5789" style="font-family: STIXGeneral-Italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.044em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.689em; left: 0.739em;"><span class="mo" id="MathJax-Span-5790" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5791" style=""><span style="font-family: STIXGeneral-Regular;">⟩</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.153em; vertical-align: -0.299em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-248">\left< YX^* \right></script>. The fit is plotted in a <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_X69a_WVR-SPW0-DA45QUXY.pdf">*QUXY.pdf PDF file</a> <img src="resources/1782E0EE4A5C7FD531F2AE9BB454D7D8.png" alt="QUXY.png" width="1569" height="1181">.<br>
The <span class="MathJax" id="MathJax-Element-244-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5749" style="width: 2.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.914em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.35em, 1000em, 2.379em, -0.396em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-5750"><span class="msubsup" id="MathJax-Span-5751"><span style="display: inline-block; position: relative; width: 1.877em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.717em, -0.396em); top: -2.534em; left: 0em;"><span class="mn" id="MathJax-Span-5752" style="font-family: STIXGeneral-Regular;">180</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.712em; left: 1.52em;"><span class="texatom" id="MathJax-Span-5753"><span class="mrow" id="MathJax-Span-5754"><span class="mo" id="MathJax-Span-5755" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∘</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.892em; vertical-align: -0.078em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-244">180^{\circ}</script> ambiguity is solved with the fitted (Q, U) and it takes complex conjugate of *XYspec.npy if necessary. On-axis D-term spectra of tracking antennas are solved and stored in <code>*DSpec.npy</code> files. The last three sentences in <code>checkQU.py</code> renames the <code>*DSpec.npy</code> files and store thems into a relevant directory. If <code>rename</code> command is not available (e.g. MacOSX), change the file name by another way. A <a href="http://www.alma.cl/~skameno/AMAPOLA/D_uid___A002_Xa018c4_X69a_WVR-REFDA45-Dspec.pdf">*Dspec.pdf</a> file plots D-term spectra.<img src="resources/C639529780421BAC856BB786FCD3B47A.png" alt="Dspec.png" width="1589" height="1239"></p>
</div><div class="cell markdown-cell"><h2>Step.4 In-beam polarized beam map</h2>
<p>We have already determined (Q, U) of the calibrator, XY phase, bandpass, gains and D-terms of tracking antennas. Then, the script <code>stokesBeamSpec.py</code> solves for gains and D-terms of scanning antennas by using these known values. Prepare a wrapping file <a href="http://www.alma.cl/~skameno/AMAPOLA/stokesBeamExec.py">stokesBeamExec.py</a>,</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_comment"># stokesBeamExec.py</span>
</div><div class="ace_line"><span class="ace_identifier">CR_DIR</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'/home/skameno/ALMA_SV/'</span> <span class="ace_comment"># Script Directory</span>
</div><div class="ace_line"><span class="ace_identifier">wd</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'./'</span>                         <span class="ace_comment"># Working directory</span>
</div><div class="ace_line"><span class="ace_identifier">Dpath</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'./DtermB6/'</span>              <span class="ace_comment"># path to the D-term files</span>
</div><div class="ace_line"><span class="ace_identifier">antFlag</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">scan</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">2</span>                          <span class="ace_comment"># scan number</span>
</div><div class="ace_line"><span class="ace_identifier">QUmodel</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language">True</span>
</div><div class="ace_line"><span class="ace_identifier">spwList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span>,<span class="ace_constant ace_numeric">1</span>,<span class="ace_constant ace_numeric">2</span>,<span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">prefixList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_string">'uid___A002_Xa018c4_X69a_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_X6a1_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_X6f2_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_X91c_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_X920_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_X96d_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_Xc9b_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_Xcab_WVR'</span>, <span class="ace_string">'uid___A002_Xa018c4_Xd3b_WVR'</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">refantName</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'DA59'</span>
</div><div class="ace_line"><span class="ace_identifier">fileList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1</span>,<span class="ace_constant ace_numeric">4</span>,<span class="ace_constant ace_numeric">7</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">BPprefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'uid___A002_Xa018c4_X91c_WVR'</span>
</div><div class="ace_line"><span class="ace_identifier">QUprefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'uid___A002_Xa018c4_X69a_WVR'</span>
</div><div class="ace_line"><span class="ace_identifier">XYprefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'uid___A002_Xa018c4_X69a_WVR'</span>
</div><div class="ace_line"><span class="ace_keyword">for</span> <span class="ace_identifier">spw</span> <span class="ace_keyword">in</span> <span class="ace_identifier">spwList</span>:
</div><div class="ace_line">    <span class="ace_keyword">for</span> <span class="ace_identifier">file_index</span> <span class="ace_keyword">in</span> <span class="ace_identifier">fileList</span>:
</div><div class="ace_line"><span class="ace_indent-guide">    </span>    <span class="ace_identifier">prefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">prefixList</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">file_index</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function">execfile</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">'stokesBeamSpec.py'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line">    <span class="ace_comment">#</span>
</div><div class="ace_line"><span class="ace_comment">#</span>
</div><div class="ace_line"><span class="ace_comment">#</span>
</div><div class="ace_line"><span class="ace_identifier">refantName</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'DA45'</span>
</div><div class="ace_line"><span class="ace_identifier">fileList</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span>,<span class="ace_constant ace_numeric">5</span>,<span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_identifier">QUXYprefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'uid___A002_Xa018c4_X69a_WVR'</span>
</div><div class="ace_line"><span class="ace_keyword">for</span> <span class="ace_identifier">spw</span> <span class="ace_keyword">in</span> <span class="ace_identifier">spwList</span>:
</div><div class="ace_line">    <span class="ace_keyword">for</span> <span class="ace_identifier">file_index</span> <span class="ace_keyword">in</span> <span class="ace_identifier">fileList</span>:
</div><div class="ace_line"><span class="ace_indent-guide">    </span>    <span class="ace_identifier">prefix</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">prefixList</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">file_index</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function">execfile</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">SCR_DIR</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">'stokesBeamSpec.py'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line">    <span class="ace_comment">#</span>
</div><div class="ace_line"><span class="ace_comment">#</span>
</div></div></div></div><div class="cell markdown-cell"><p>and run it.</p>
</div><div class="cell code-cell"><div class="ace-solarized-light"><div class="ace_static_highlight" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_identifier">casa</span> <span class="ace_keyword ace_operator">-</span><span class="ace_identifier">c</span> <span class="ace_identifier">stokesBeamExec</span>.<span class="ace_identifier">py</span>
</div></div></div></div><div class="cell markdown-cell"><p>The script estimates D-term spectrum of each beam offset in each antenna, and then store it to <code>*Dterm.npy</code> files. Antenna-based D-term spectra are also plotted in <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_Xcab_WVR-DA41-SPW2-OFF8.4-DtermSpec.pdf">*DtermSpec.pdf</a> files.<img src="resources/C4835CAA605E6BEAAD5D4124FE2CE9B3.png" alt="DspecBeam.png" width="834" height="1228"></p>
</div><div class="cell markdown-cell"><p><a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_Xcab_WVR-DA41-SPW2-DtermMap.pdf">Channel-averaged D-term map</a> of each scanning antenna is also plotted. The blue and green circles stand for the FWHM and -6 dB (25% power) beam widths.<br>
<img src="resources/80495FDFE6274BC582EB936C68ABEFB6.png" alt="ChAvDtermMap.png" width="1170" height="1222"></p>
</div><div class="cell markdown-cell"><p>The D-term spectra and complex gain are recorded in <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_Xcab_WVR-DA41-SPW2-beamGainD.log">*-beamGainD.log</a> files.</p>
</div><div class="cell markdown-cell"><p>Then, <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_X6a1_WVR--SPW2-OFF8.4-StokesSpec.pdf">full Stokes spectra</a> and <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_Xd3b_WVR-SPW2-StokesMap.pdf">channel-averaged Stokes Map</a> are determined at each beam-offset position by using visibilities of scanning antennas only. The in-beam Stokes spectra are recorded in <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_Xcab_WVR-SPW2-StokesSpec.log">*-StokesSpec.log</a></p>
<p>The <a href="http://www.alma.cl/~skameno/AMAPOLA/uid___A002_Xa018c4_Xd3b_WVR-SPW2-StokesErr.pdf">polarization error map</a> shows departure from the Stokes parameters determined in Step.3 (We assume Stokes V = 0).<br>
<img src="resources/ECBC2A721043BE0411100F77FB1D9EA7.png" alt="StokesSpecMap.png" width="849" height="1224"><br>
<img src="resources/B8819DCE2A37F4A104C9C77A639CE256.png" alt="StokesMap.png" width="1174" height="1209"><br>
<img src="resources/978A8D104B657B48306249E58BAC967C.png" alt="StokesErr.png" width="1120" height="1210"></p>
</div><div class="cell markdown-cell"><hr>
<p><a href="http://www.alma.cl/~skameno/AMAPOLA/">back to AMAPOLA top</a></p>
</div><div class="cell markdown-cell"></div><div class="cell markdown-cell"></div><div class="cell markdown-cell"></div></div>
      <script></script>
    </body>
    </html>
  